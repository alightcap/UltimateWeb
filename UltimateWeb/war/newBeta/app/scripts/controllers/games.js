// Generated by CoffeeScript 1.7.1
'use strict';
angular.module('newBetaApp').controller('GamesCtrl', function($scope, $q, allGames, teamStats, playerStats) {
  var global, openPoints, scope;
  global = {};
  scope = $scope;
  scope.loading = true;
  $q.all([allGames, teamStats, playerStats]).then(function(things) {
    global.games = things[0];
    global.tsApi = things[1];
    global.psApi = things[2];
    scope.select(_(global.games).max(function(game) {
      return game.msSinceEpoch;
    }));
    return scope.loading = false;
  });
  allGames.then(function(games) {
    scope.games = games;
    return scope.sortedGames = _(games).toArray();
  });
  scope.isSelectedGame = function(game) {
    return game === scope.selectedGame;
  };
  scope.select = function(game) {
    var ps, ts;
    scope.gameLoading = true;
    scope.selectedGame = game;
    ps = global.psApi.getFrom([game]);
    ts = global.tsApi.getFrom([game]);
    return scope.gameLoading = false;
  };
  openPoints = {};
  scope.togglePoints = function(points, only) {
    if (only) {
      openPoints = {};
    }
    return _(_(points).pluck('$$hashKey')).each(function(id) {
      return openPoints[id] = !openPoints[id];
    });
  };
  return scope.isOpen = function(point) {
    return openPoints[point['$$hashKey']];
  };
});
